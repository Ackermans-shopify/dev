if(!customElements.get("m-product-bundle")){class e extends HTMLElement{constructor(){super(),this.selectors={bundleError:".product-bundles__error",productVariantSelects:".m-product-option--dropdown-select",totalPrice:"[data-total-price]",submitBundle:"[data-add-bundle]",errorWrapper:".product-bundles__error",cartDrawer:"m-cart-drawer"},this.domNodes=queryDomNodes(this.selectors,this)}connectedCallback(){this.initProductBundles()}initProductBundles(){let e=[],t=[];const r=this.querySelectorAll(".product-bundles__item");for(let s of r){let r=s.nextElementSibling;r&&r.hasAttribute("data-product-variants")&&(r=JSON.parse(r.innerHTML),t.push(r),e.push(s),addEventDelegate({context:s,event:"change",selector:this.selectors.productVariantSelects,handler:t=>this._handleChangePrice(t,s,r,e)}))}addEventDelegate({context:this,selector:this.selectors.submitBundle,handler:e=>this._handleAddItems(e,this)})}_handleChangePrice(e,t,r,s){const i=t.querySelector("[data-regular-price]");let o=t.querySelector("[data-compare-price]"),n=t.querySelector("[data-saved-price]"),a=t.querySelector(".product-bundles__save-price");const c=e.target.value,d=r.find((e=>e.id===parseInt(c)));i.innerHTML=formatMoney(d.price,MinimogSettings.money_format),i.dataset.price=d.price,d.compare_at_price&&d.compare_at_price>d.price?(o&&(o.classList.remove("m:hidden"),o.innerHTML=formatMoney(d.compare_at_price,MinimogSettings.money_format)),a&&a.classList.remove("m:hidden"),n&&(n.classList.remove("m:hidden"),n.innerHTML=formatMoney(d.compare_at_price-d.price,MinimogSettings.money_format))):(o&&o.classList.add("m:hidden"),a&&a.classList.add("m:hidden"),n&&n.classList.add("m:hidden"));const l=s.map((e=>{let t=e.nextElementSibling.innerHTML;t=JSON.parse(t);let r=e.querySelector('[name="id"]');if(t&&r)return t.find((e=>e.id===Number(r.value)))})).filter(Boolean),m=l.reduce(((e,t)=>e+t.price),0);t.closest(".product-bundles").querySelector(this.selectors.totalPrice).innerHTML=formatMoney(m,MinimogSettings.money_format)}_handleAddItems(e,t){e.preventDefault();const r=t.querySelectorAll('[name="id"]'),s=t.querySelector(this.selectors.errorWrapper),i=t.querySelector(this.selectors.submitBundle),o=document.querySelector(this.selectors.cartDrawer);let n={items:[...r].map((e=>e.value)).map((e=>({id:e,quantity:1})))};o&&(n={...n,sections:o.getSectionsToRender().map((e=>e.id)),sections_url:window.location.pathname});const a=fetchConfig("javascript");a.method="POST",a.body=JSON.stringify(n),this._toggleLoading(!0,i);const{MinimogSettings:c,MinimogStrings:d}=window;fetch(`${c.routes.cart_add_url}`,a).then((e=>e.json())).then((e=>{e.status?this._showError(e.description||"Failed to add all items to cart!",s):c.use_ajax_atc?(c.enable_cart_drawer?(o&&o.renderContents(e),MinimogTheme.Notification.show({target:o.querySelector("m-cart-drawer-items"),method:"prepend",type:"success",message:d.itemAdded,delay:400})):window.MinimogTheme.Notification.show({target:s||document.body,method:"appendChild",type:"success",message:d.itemAdded,last:3e3,sticky:!this.domNodes.errorWrapper}),window.MinimogEvents.emit(MinimogTheme.pubSubEvents.cartUpdate,e)):window.location=c.routes.cart})).catch((e=>{})).finally((()=>{if(this._toggleLoading(!1,i),o){const e=o.querySelector("m-cart-drawer-items");o.classList.contains("m-cart--empty")&&o.classList.remove("m-cart--empty"),e&&e.classList.contains("m-cart--empty")&&e.classList.remove("m-cart--empty")}}))}_showError(e,t){MinimogTheme.Notification.show({target:t,method:"appendChild",type:"warning",message:e})}_toggleLoading(e,t){e?t.classList.add("m-spinner-loading"):t.classList.remove("m-spinner-loading")}}customElements.define("m-product-bundle",e)}